# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ STT –º–æ–¥—É–ª—è Conspekter

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –º–æ–¥–µ–ª–∏

```bash
pip install optimum-intel
```

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏ Whisper

–î–ª—è —Ä–∞–±–æ—Ç—ã STT –º–æ–¥—É–ª—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å (—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∫–≤–∞–Ω—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å) –º–æ–¥–µ–ª—å Whisper.

#### –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞):
```bash
python scripts/prepare_whisper_model.py --model base --output models/whisper-base-int8
```

#### –î—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:

**Tiny (—Å–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è, –±–∞–∑–æ–≤–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å):**
```bash
python scripts/prepare_whisper_model.py --model tiny --output models/whisper-tiny-int8
```

**Small (—Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞):**
```bash
python scripts/prepare_whisper_model.py --model small --output models/whisper-small-int8
```

**Large (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å, –º–µ–¥–ª–µ–Ω–Ω–µ–µ):**
```bash
python scripts/prepare_whisper_model.py --model large --output models/whisper-large-int8
```

#### –ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è

–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏–∏:

- **INT8** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞
- **INT4** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –Ω–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ –∫–∞—á–µ—Å—Ç–≤–æ
- **FP16** - –≤—ã—à–µ –∫–∞—á–µ—Å—Ç–≤–æ, –º–µ–¥–ª–µ–Ω–Ω–µ–µ
- **FP32** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, —Å–∞–º–∞—è –º–µ–¥–ª–µ–Ω–Ω–∞—è

–ü—Ä–∏–º–µ—Ä —Å –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏–µ–π INT4:
```bash
python scripts/prepare_whisper_model.py --model base --quantization int4 --output models/whisper-base-int4
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.yaml` –∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏:

```yaml
stt:
  model_path: models/whisper-base-int8
  device: AUTO
```

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
python main.py
```

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://localhost:5000/stt –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è STT –º–æ–¥—É–ª—è.

## –í—ã–±–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–í `config.yaml` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```yaml
stt:
  device: AUTO

devices:
  priority:
    - NPU
    - GPU  
    - CPU
```

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç –ª—É—á—à–µ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞.

### –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä

–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:

```yaml
stt:
  device: NPU
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
- **NPU** - Intel AI Boost (13 TOPS –Ω–∞ Ultra 7 255H)
- **GPU** - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞ Intel Arc
- **CPU** - –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/stt` –∏ –Ω–∞–∂–º–∏—Ç–µ "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å STT" - —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

–ò–ª–∏ —á–µ—Ä–µ–∑ Python:

```python
import openvino as ov
core = ov.Core()
print(core.available_devices)
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

### Lenovo ThinkPad P16v (Ultra 7 255H)

–í–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- **NPU**: Intel AI Boost, 13 TOPS
- **iGPU**: Intel Arc 140T, 128 tensor cores
- **RAM**: 96GB
- **vRAM**: 128MB (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞)

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ NPU —Å –º–æ–¥–µ–ª—å—é `whisper-base-int8` –∏–ª–∏ `whisper-tiny-int8`
2. **–î–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU —Å –º–æ–¥–µ–ª—å—é `whisper-small-int8`
3. **–î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ª–µ–∫—Ü–∏–π** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CPU —Å –±–æ–ª—å—à–æ–π –º–æ–¥–µ–ª—å—é (—É –≤–∞—Å 96GB RAM)

#### –ü—Ä–∏–º–µ—Ä–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

| –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ | –ú–æ–¥–µ–ª—å | –°–∫–æ—Ä–æ—Å—Ç—å | –ö–∞—á–µ—Å—Ç–≤–æ |
|-----------|--------|----------|----------|
| NPU | whisper-tiny-int8 | ‚ö°‚ö°‚ö° | ‚≠ê‚≠ê |
| NPU | whisper-base-int8 | ‚ö°‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê |
| GPU | whisper-base-int8 | ‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê |
| GPU | whisper-small-int8 | ‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê |
| CPU | whisper-large-int8 | üê¢ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |

## Troubleshooting

### NPU –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥—Ä–∞–π–≤–µ—Ä NPU (–≤–µ—Ä—Å–∏—è 32.0.100.3104+)
2. –û–±–Ω–æ–≤–∏—Ç–µ OpenVINO –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏: `pip install --upgrade openvino`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É NPU: –í Windows –æ—Ç–∫—Ä–æ–π—Ç–µ Device Manager –∏ –Ω–∞–π–¥–∏—Ç–µ "Neural Processors"

### –û—à–∏–±–∫–∞ "Model not found"

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –º–æ–¥–µ–ª–∏:
```bash
python scripts/prepare_whisper_model.py --model base --output models/whisper-base-int8
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è

1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –º–µ–Ω—å—à—É—é –º–æ–¥–µ–ª—å (tiny –∏–ª–∏ base)
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ INT4 –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—é –≤–º–µ—Å—Ç–æ INT8
3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ NPU –∏–ª–∏ GPU –≤–º–µ—Å—Ç–æ CPU

### –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª—å—à—É—é –º–æ–¥–µ–ª—å (small, medium, large)
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ FP16 –≤–º–µ—Å—Ç–æ INT8
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞—É–¥–∏–æ —Ö–æ—Ä–æ—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (–º–∏–Ω–∏–º—É–º 16kHz)

## API

### REST API Endpoints

#### GET /api/stt/status
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å STT —Å–µ—Ä–≤–∏—Å–∞

#### GET /api/stt/devices
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

#### POST /api/stt/initialize
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å STT —Å–µ—Ä–≤–∏—Å –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å

#### POST /api/transcribe
–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ—Ñ–∞–π–ª

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (multipart/form-data):
- `audio` (file) - –∞—É–¥–∏–æ—Ñ–∞–π–ª
- `language` (string) - —è–∑—ã–∫ ("ru", "en", –∏ —Ç.–¥.)
- `device` (string, optional) - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "text": "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç",
  "language": "ru",
  "device": "NPU"
}
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [OpenVINO Whisper Documentation](https://docs.openvino.ai/2025/notebooks/whisper-asr-genai-with-output.html)
- [Intel NPU Support](https://docs.openvino.ai/2025/openvino-workflow-generative/inference-with-genai/inference-with-genai-on-npu.html)
